const translations = {
  ca: {
    date: '7 DE MARÇ',
    date_label: 'DATA',
    time_label: 'HORARI',
    time_value: '17:00h',
    price_label: 'PREU',
    price_value: 'Taquilla inversa (aportació recomanada 5€)',
    extras_label: 'EXTRES',
    extras_value: 'Menjar vegà i beguda a preus populars',
    nav_concerts: 'LINE UP',
    nav_activities: 'ACTIVITATS',
    nav_20years: '20 ANYS',
    nav_participate: 'PARTICIPA',
    nav_location: 'ON ÉS?',
    noise_title: '20 ANYS DE SOROLL I RESISTÈNCIA',
    noise_desc:
      "Dues dècades demostrant que el metall no té gènere. La nostra veu és gutural, la nostra presència inesborrable. Contra el patriarcat, volum al màxim. Som les reines de l'acer i hem vingut a fer tremolar els fonaments.",
    activities_title: 'ACTIVITATS',
    act_fascismo_title: 'METALL ENFRONT DEL FEIXISME',
    act_fascismo_desc:
      "Un conversatori sobre la història, la resistència i l'activisme dins l'escena extrema.",
    act_fascismo_speakers_title: 'Un conversatori amb:',
    act_fascismo_speakers:
      "Raquel García<br><small>(fotògrafa i fundadora de Rockin' Ladies)</small><br>Emilio Casal<br><small>(Bocc, Tugurio i Veratre)</small><br>i dinamitzada per Sol",
    act_fascismo_schedule_title: 'Dissabte 7 de març',
    act_fascismo_schedule: '17:30h @ Palau Alós',
    help_title: 'ENS DÓNES UN COP DE MÀ?',
    help_desc:
      "Busquem gent per l'equip de treball. Sense vosaltres això no seria possible. T'apuntes a fer un torn?",
    role_bar: 'BARRA',
    role_stage: 'ESCENARI',
    role_access: 'ACCÉS',
    role_logistics: 'LOGÍSTICA',
    role_transport: 'TRANSPORT',
    write_us: 'ESCRIU-NOS',
    location_title: 'ON ÉS?',
    footer_design: 'Dissenyat per la Causa. Autogestió sempre.',
    nav_mercadillo: 'MERCADET',
    mercadillo_title: 'MERCADET FEMINISTA',
    mercadillo_intro: '17:00h | OBERTURA I MERCADET DIY Distribució i artesania amb:',
    maldo_desc:
      "Projecte gràfic de Marta Maldonado (Maldo) centrat en el món editorial i musical. A través de l'oli i la tinta, fusiona natura, mitologia, metall i foscor.",
    ultrachains_desc:
      "Des de Madrid arriba aquest projecte de joieria artesanal en acer inoxidable. Peces de cota de malla inspirades en l'estètica punk i creades a mà.",
    mda_desc:
      "Col·lectiu que munta concerts de punk, xerrades i distribueix materials sota la bandera de l'autogestió. Bons llibres, fanzines i música.",
    corv_desc:
      "Projecte que aposta per l'autogestió i el reciclatge creatiu. Des de pegats serigrafiats fins a accessoris amb materials recuperats.",
    marica_desc:
      "Il·lustració i tatuatge que explora i qüestiona els sistemes d'opressió, visibilitzant formes de resistència. Personatges emancipats i desafiants.",
    susana_desc:
      "Il·lustradora i editora de fanzines enfocada en l'imaginari psycho-heavy i la gràfica musical, amb un fort component reivindicatiu.",
    flamigera_desc:
      "Projecte de roba intervinguda a mà i serigrafia que recrea l'imaginari de bandes de metall i punk sota un estil propi.",
    impia_desc: 'Dbeat cru i metal·litzat',
    footer_credits: 'Web feta per',
    footer_opensource: 'NO COPYRIGHT. Codi font',
    title_home: 'Queens of Steel Fest 2026',
    title_20years: '20 Anys | Queens of Steel Fest',
    title_concerts: 'Line Up | Queens of Steel Fest',
    title_mercadillo: 'Mercadet | Queens of Steel Fest',
    title_activities: 'Activitats | Queens of Steel Fest',
    title_participate: 'Participa | Queens of Steel Fest',
    title_location: 'Ubicació | Queens of Steel Fest',
    meta_description:
      'Queens of Steel Fest 2026. 20 anys de soroll i resistència. Festival de metall, punk i hardcore a Barcelona. 7 de Març.',
  },
  es: {
    date: '7 DE MARZO',
    date_label: 'FECHA',
    time_label: 'HORARIO',
    time_value: '17:00h',
    price_label: 'PRECIO',
    price_value: 'Taquilla inversa (aportación recomendada 5€)',
    extras_label: 'EXTRAS',
    extras_value: 'Comida vegana y bebida a precios populares',
    nav_concerts: 'LINE UP',
    nav_activities: 'ACTIVIDADES',
    nav_20years: '20 AÑOS',
    nav_participate: 'PARTICIPA',
    nav_location: '¿DÓNDE ES?',
    noise_title: '20 AÑOS DE RUIDO Y RESISTENCIA',
    noise_desc:
      'Dos décadas demostrando que el metal no tiene género. Nuestra voz es gutural, nuestra presencia imborrable. Contra el patriarcado, volumen al máximo. Somos las reinas del acero y hemos venido a hacer temblar los cimientos.',
    activities_title: 'ACTIVIDADES',
    act_fascismo_title: 'METAL FRENTE AL FASCISMO',
    act_fascismo_desc:
      'Un conversatorio sobre la historia, la resistencia y el activismo dentro de la escena extrema.',
    act_fascismo_speakers_title: 'Un conversatorio con:',
    act_fascismo_speakers:
      "Raquel García<br><small>(fotógrafa y fundadora de Rockin' Ladies)</small><br>Emilio Casal<br><small>(Bocc, Tugurio y Veratre)</small><br>y dinamizada por Sol",
    act_fascismo_schedule_title: 'Sábado 7 de marzo',
    act_fascismo_schedule: '17:30h @ Palau Alós',
    help_title: '¿NOS ECHAS UNA MANO?',
    help_desc:
      'Buscamos gente para el equipo de trabajo. Sin vosotrxs esto no sería posible. ¿Te apuntas a hacer un turno?',
    role_bar: 'BARRA',
    role_stage: 'ESCENARIO',
    role_access: 'ACCESO',
    role_logistics: 'LOGÍSTICA',
    role_transport: 'TRANSPORTE',
    write_us: 'ESCRÍBENOS',
    location_title: '¿DÓNDE ES?',
    footer_design: 'Diseñado por la Causa. Autogestión siempre.',
    nav_mercadillo: 'MERCADILLO',
    mercadillo_title: 'MERCADILLO FEMINISTA',
    mercadillo_intro: '17:00h | APERTURA Y MERCADILLO DIY Distribución y artesanía con:',
    maldo_desc:
      'Proyecto gráfico de Marta Maldonado (Maldo) centrado en el mundo editorial y musical. A través del óleo y la tinta, fusiona naturaleza, mitología, metal y oscuridad.',
    ultrachains_desc:
      'Desde Madrid llega este proyecto de joyería artesanal en acero inoxidable. Piezas de cota de malla inspiradas en la estética punk y creadas a mano.',
    mda_desc:
      'Colectivo que monta conciertos de punk, charlas y distribuye materiales bajo la bandera de la autogestión. Buenos libros, fanzines y música.',
    corv_desc:
      'Proyecto que apuesta por la autogestión y el reciclaje creativo. Desde parches serigrafiados hasta accesorios con materiales recuperados.',
    marica_desc:
      'Ilustración y tatuaje que explora y cuestiona los sistemas de opresión, visibilizando formas de resistencia. Personajes emancipadxs y desafiantes.',
    susana_desc:
      'Ilustradora y editora de fanzines enfocada en el imaginario psycho-heavy y la gráfica musical, con un fuerte componente reivindicativo.',
    flamigera_desc:
      'Proyecto de ropa intervenida a mano y serigrafía que recrea el imaginario de bandas de metal y punk bajo un estilo propio.',
    impia_desc: 'Dbeat crudo y metalizado',
    footer_credits: 'Web hecha por',
    footer_opensource: 'NO COPYRIGHT. Código fuente',
    title_home: 'Queens of Steel Fest 2026',
    title_20years: '20 Años | Queens of Steel Fest',
    title_concerts: 'Line Up | Queens of Steel Fest',
    title_mercadillo: 'Mercadillo | Queens of Steel Fest',
    title_activities: 'Actividades | Queens of Steel Fest',
    title_participate: 'Participa | Queens of Steel Fest',
    title_location: 'Ubicación | Queens of Steel Fest',
    meta_description:
      'Queens of Steel Fest 2026. 20 años de ruido y resistencia. Festival de metal, punk y hardcore en Barcelona. 7 de Marzo.',
  },
  en: {
    date: 'MARCH 7TH',
    date_label: 'DATE',
    time_label: 'TIME',
    time_value: '17:00h',
    price_label: 'PRICE',
    price_value: 'Pay what you want (recommended €5)',
    extras_label: 'EXTRAS',
    extras_value: 'Vegan food and drinks at popular prices',
    nav_concerts: 'LINE UP',
    nav_activities: 'ACTIVITIES',
    nav_20years: '20 YEARS',
    nav_participate: 'PARTICIPATE',
    nav_location: 'WHERE IS IT?',
    nav_mercadillo: 'MARKET',
    noise_title: '20 YEARS OF NOISE AND RESISTANCE',
    noise_desc:
      'Two decades proving that metal has no gender. Our voice is guttural, our presence indelible. Against patriarchy, maximum volume. We are the queens of steel and we have come to shake the foundations.',
    activities_title: 'ACTIVITIES',
    act_fascismo_title: 'METAL AGAINST FASCISM',
    act_fascismo_desc:
      'A conversation about history, resistance, and activism within the extreme scene.',
    act_fascismo_speakers_title: 'A conversation with:',
    act_fascismo_speakers:
      "Raquel García<br><small>(photographer and founder of Rockin' Ladies)</small><br>Emilio Casal<br><small>(Bocc, Tugurio and Veratre)</small><br>and moderated by Sol",
    act_fascismo_schedule_title: 'Saturday March 7th',
    act_fascismo_schedule: '17:30h @ Palau Alós',
    mercadillo_title: 'FEMINIST MARKET',
    mercadillo_intro: '17:00h | OPENING AND DIY MARKET Distribution and crafts with:',
    maldo_desc:
      'Graphic project by Marta Maldonado (Maldo) focused on the editorial and musical world. Through oil and ink, she merges nature, mythology, metal, and darkness.',
    ultrachains_desc:
      'From Madrid comes this handmade stainless steel jewelry project. Chainmail pieces inspired by punk aesthetics and created by hand.',
    mda_desc:
      'Collective that organizes punk concerts, talks, and distributes materials under the banner of self-management. Good books, fanzines, and music.',
    corv_desc:
      'Project that bets on self-management and creative recycling. From screen-printed patches to accessories with recovered materials.',
    marica_desc:
      'Illustration and tattoo that explores and questions systems of oppression, visualizing forms of resistance. Emancipated and defiant characters.',
    susana_desc:
      'Illustrator and fanzine editor focused on psycho-heavy imagery and musical graphics, with a strong vindictive component.',
    flamigera_desc:
      'Hand-intervened clothing and screen printing project that recreates the imagery of metal and punk bands under its own style.',
    help_title: 'CAN YOU GIVE US A HAND?',
    help_desc:
      'We are looking for people for the work team. Without you, this would not be possible. Are you up for a shift?',
    role_bar: 'BAR',
    role_stage: 'STAGE',
    role_access: 'ACCESS',
    role_logistics: 'LOGISTICS',
    role_transport: 'TRANSPORT',
    write_us: 'WRITE TO US',
    location_title: 'WHERE IS IT?',
    footer_design: 'Designed for the Cause. Self-management always.',
    impia_desc: 'Raw and metallic Dbeat',
    footer_credits: 'Website by',
    footer_opensource: 'NO COPYRIGHT. Source Code',
    title_home: 'Queens of Steel Fest 2026',
    title_20years: '20 Years | Queens of Steel Fest',
    title_concerts: 'Line Up | Queens of Steel Fest',
    title_mercadillo: 'Market | Queens of Steel Fest',
    title_activities: 'Activities | Queens of Steel Fest',
    title_participate: 'Participate | Queens of Steel Fest',
    title_location: 'Location | Queens of Steel Fest',
    meta_description:
      'Queens of Steel Fest 2026. 20 years of noise and resistance. Metal, punk and hardcore festival in Barcelona. March 7th.',
  },
};

let currentSection = 'home';

function updateTitle(lang) {
  if (!translations[lang]) return;

  // Map sections to title keys
  const titleMap = {
    home: 'title_home',
    '20-anys': 'title_20years',
    concerts: 'title_concerts',
    mercadet: 'title_mercadillo',
    activitats: 'title_activities',
    voluntaris: 'title_participate',
    ubicacio: 'title_location',
  };

  const titleKey = titleMap[currentSection] || 'title_home';
  if (translations[lang][titleKey]) {
    document.title = translations[lang][titleKey];
  }
}

function setLang(lang) {
  if (!translations[lang]) return;

  document.documentElement.lang = lang;

  // Update buttons
  document.querySelectorAll('.lang-switch button').forEach(btn => {
    btn.classList.remove('active');
  });
  document.getElementById('btn-' + lang).classList.add('active');

  // Update text content
  document.querySelectorAll('[data-key]').forEach(el => {
    const key = el.getAttribute('data-key');
    if (translations[lang] && translations[lang][key]) {
      el.innerHTML = translations[lang][key];
    }
  });

  // Update titles on language change
  updateTitle(lang);

  // Update meta description
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc && translations[lang].meta_description) {
    metaDesc.setAttribute('content', translations[lang].meta_description);
  }

  // Update URL without reloading
  const newUrl = new URL(window.location);
  newUrl.searchParams.set('lang', lang);
  window.history.pushState({}, '', newUrl);
}

// Check URL for language param on load
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const langParam = params.get('lang');
  let currentLang = 'es'; // Default

  if (langParam && translations[langParam]) {
    currentLang = langParam;
  }

  setLang(currentLang);

  // Dynamic Title Observer
  const sections = document.querySelectorAll('section, header');
  const titleObserver = new IntersectionObserver(
    entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Map ID to section key logic
          const id = entry.target.id;
          // Special handling for header (id="inici") mapping to 'home'
          // and sections mapping to their IDs or simplified versions
          if (id === 'inici') currentSection = 'home';
          else if (id === 'mercadet') currentSection = 'mercadet';
          else if (id === 'activitats') currentSection = 'activitats';
          else if (id === 'voluntaris') currentSection = 'voluntaris';
          else if (id === 'ubicacio') currentSection = 'ubicacio';
          else if (id === '20-anys') currentSection = '20-anys';
          else if (id === 'concerts') currentSection = 'concerts';

          updateTitle(document.documentElement.lang);
        }
      });
    },
    {
      threshold: 0.51, // Trigger when more than half visible
    }
  );

  sections.forEach(section => {
    titleObserver.observe(section);
  });
});

// El smooth scroll es gestiona nativament per CSS (scroll-behavior: smooth)
// per permetre que els hashes es reflecteixin a la URL.

// Simple Reveal on Scroll
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.style.opacity = 1;
      entry.target.style.transform = 'translateY(0)';
    }
  });
});

// Aplica l'animació a les cards
document.querySelectorAll('.band-card, .mercadillo-card').forEach(el => {
  el.style.opacity = 0;
  el.style.transform = 'translateY(20px)';
  el.style.transition = 'all 0.6s ease-out';
  observer.observe(el);
});

// Inicialització del mapa Leaflet
function initMap() {
  const palauAlosCoords = [41.384261, 2.178873];
  const map = L.map('map').setView(palauAlosCoords, 17);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:
      '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  }).addTo(map);

  L.marker(palauAlosCoords)
    .addTo(map)
    .bindPopup('<b>Palau Alòs</b><br>c/ Sant Pere Més Baix 55, 08003 Barcelona')
    .openPopup();
}

// Inicialitza el mapa quan el contingut s'ha carregat
document.addEventListener('DOMContentLoaded', initMap);
